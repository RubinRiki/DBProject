# DBProject
# 🍷 פרויקט בסיס נתונים – יקב חכם

## 👩‍💻 מגישות:
- ריקי רובין 326380359
- איילה כהן 327519161

## 📚 מבוא:
הפרויקט מתאר מערכת לניהול כולל של יקב. כל אחת מהמשתתפות בפרויקט אחראית על מחלקה שונה מתוך המערכת.  
המערכת שלנו מתמקדת במחלקת **הייצור** של היין – תהליך הליבה של פעילות היקב – ואנו אחראיות על עיצוב ויישום בסיס הנתונים שלה.

מערכת מחלקת הייצור עוקבת אחר שלבי הפקת היין: החל מבציר הענבים, דרך תהליכי הייצור השונים (כגון תסיסה, יישון וערבוב), וכלה ביצירת מוצר סופי.  
המערכת מתעדת את העובדים, הציוד, חומרי הגלם, הענבים והמיכלים הנדרשים לתהליך, וכן מאפשרת מעקב מדויק אחרי כל אצוות הייצור (Batch).

---

## 🧱 ישויות עיקריות במערכת:

| ישות | תיאור |
|------|--------|
| **Employee** | עובד ייצור המפעיל ציוד ומבצע תהליכים |
| **ProductionProcess** | שלב בתהליך הייצור (תסיסה, סינון, יישון, ערבוב) |
| **Grapes** | אצוות ענבים שנבצרו לשימוש בייצור |
| **RawMaterials** | חומרים נוספים כגון שמרים, חומרים משמרים וכו' |
| **Containers** | מיכלים וחביות ליישון היין |
| **ProductionEquipment** | ציוד ומכונות בשימוש |
| **FinalProduct** | ליין מוצרים סופי – כולל סוג יין וכמות בקבוקים |

---

## 🔄 קשרים עיקריים בין הישויות:

- כל תהליך מבוצע ע"י עובד אחד.
- כל תהליך משתמש במספר סוגי ציוד, חומרים, ענבים ומיכלים (קשרים M:N).
- כל 4 תהליכים מובילים ל־FinalProduct אחד.

---

## 🖼️ תרשימים:

### ERD:
![ERD](./ERD/image%20(2).png)

### DSD:
![DSD](./DSD/image%20(3).png)

---

## 🧪 הכנסת נתונים – 3 שיטות:

### ✅ שיטה 1: קבצי CSV
בוצעה ייבוא של נתונים לקובץ דרך `Import` ב־pgAdmin:
- Grapes.csv
- containers.csv
- final_product.csv

### ✅ שיטה 2: קוד Python
קבצים שנוצרו על ידי סקריפטים והוזנו למסד הנתונים:
- productionprocess.csv
- process_equipment.csv
- process_materials.csv
- process_containers.csv
- ועוד...

### ✅ שיטה 3: SQL ידני
קובץ `insertTables.sql` 

---

## 💾 גיבוי:
בוצע גיבוי לדאטאבייס דרך pgAdmin.  
שם הקובץ: `backup_22042025.backup`  
נמצא בתיקייה `שלב א`.

---
## 🧩 שלב ב – שאילתות, אילוצים ופעולות בסיס נתונים
## 📄 קבצים שנוצרו:
Queries.sql – קובץ עם שאילתות SELECT / UPDATE / DELETE.
Constraints.sql – קובץ עם שלושה אילוצים (ALTER TABLE).
RollbackCommit.sql – הדגמות של ROLLBACK ו־COMMIT.
backup2.backup – גיבוי מעודכן לאחר שלב ב.

עדכונים ושינויים: 
* שדה winetype_ הכיל ערכים מספריים ולכן עודכן ל־varchar(30)
* עודכנו הערכים הבעייתיים ידנית לפי סוגי הענבים מתוך טבלה שנוצרה במיוחד (grape_varieties).

## שאילתות SELECT

1️⃣ מספר עובדים וכמות תהליכים שהובילו
מטרת השאילתה: להציג עבור כל עובד את מספר תהליכי הייצור שהוא הוביל.
מאפשר לדעת מי מהעובדים יותר פעיל בתהליכים – אינדיקציה לניסיון או לעומס עבודה.

![תוצאה של שאילתה 1](שלב%20ב/images/select1.jpg)


2️⃣ מוצרים סופיים שבוקבקו ברבעון הראשון
מטרת השאילתה: לשלוף מוצרים סופיים שבוקבקו בין ינואר למרץ, כולל תאריך הביקבוק וכמות הבקבוקים.
עוזר לנתח זמני ייצור ולבדוק תפוקה לפי רבעון.

![תוצאה של שאילתה 2](שלב%20ב/images/select2.jpg)


3️⃣ כמות חומרי גלם בכל תהליך
מטרת השאילתה: לבדוק כמה סוגים שונים של חומרי גלם שימשו בכל תהליך ייצור.
שימושי לבדיקת מורכבות התהליכים – תהליך עם יותר חומרים עשוי להיות מורכב יותר.

![תוצאה של שאילתה 3](שלב%20ב/images/select3.jpg)

4️⃣ תהליכים לפי סוג ענבים
מטרת השאילתה: להציג את כל התהליכים שבוצעו לפי סוג הענבים בהם נעשה שימוש.
מאפשר מעקב אחר אילו ענבים משמשים באילו תהליכים – רלוונטי לניתוח איכות או התאמה.

![תוצאה של שאילתה 4](שלב%20ב/images/select4.jpg)

5️⃣ כמות הבקבוקים הסופיים לפי סוג ענבים
מטרת השאילתה: לסכום את מספר הבקבוקים שיוצרו לפי סוג הענבים.
עוזר לזהות אילו סוגי ענבים מובילים לתפוקה גבוהה יותר.

![תוצאה של שאילתה 5](שלב%20ב/images/select5.jpg)


6️⃣ תהליכים שהחלו בפברואר
מטרת השאילתה: למצוא תהליכים שהחלו בחודש פברואר, כולל סוג הענבים ושם העובד שהוביל אותם.
מאפשר ניתוח עונתי של התחלת תהליכים ומעקב אחרי פעילות עובדים לפי חודש.

![תוצאה של שאילתה 6](שלב%20ב/images/select6.jpg)

7️⃣ תהליכים עם הציוד שבו השתמשו
מטרת השאילתה: להציג את הציוד שנעשה בו שימוש בכל תהליך, כולל סוג הציוד והסטטוס שלו.
מאפשר לבדוק תקלות, עומס או תחזוקה לפי שימוש בציוד.

![תוצאה של שאילתה 7](שלב%20ב/images/select7.jpg)

8️⃣ תהליכי ייצור לפי חודש
מטרת השאילתה: לקבץ את תהליכי הייצור לפי חודש התחלה ולספור כמה היו בכל חודש.
מספק תמונת מצב של עומס עבודה לאורך זמן, רלוונטי לתכנון משאבים.

![תוצאה של שאילתה 8](שלב%20ב/images/select8.jpg)

## שאילתות UPDATE
1️⃣ עדכון סוג היין (winetype_) לפי סוג הענבים
מעדכן את שדה winetype_ בטבלת finalproduct_ עבור מוצרים שעברו את כל 4 שלבי הייצור. נלקח ענב כלשהו מתוך התהליך.
![שאילתה 1 – תוצאה](שלב%20ב/images/update1aa.jpg) ![שאילתה 1 – תוצאה](שלב%20ב/images/update1a.jpg)

2️⃣ סגירת תהליך – עדכון enddate_ להיום
עבור מוצרים שעברו את כל סוגי התהליך ועדיין אין להם enddate_.
![שאילתה 2 – תוצאה](שלב%20ב/images/update2aa.jpg)  ![שאילתה 2 – תוצאה](שלב%20ב/images/update2a.jpg)

3️⃣ הורדת מלאי חומרי גלם
אם הסכום הכולל של שימוש בחומר מסוים עבר 50 יחידות – מפחיתים 10 מהמלאי.
![שאילתה 3 – תוצאה](שלב%20ב/images/update3aa.jpg) ![שאילתה 3 – תוצאה](שלב%20ב/images/update3a.jpg)

## שאילתות DELETE

1️⃣ השאילתה מוחקת תהליכי ייצור שהסתיימו לפני יותר מ־10 שנים, במטרה לנקות תהליכים ישנים שכבר אינם רלוונטיים למעקב שוטף.

2️⃣ השאילתה מוחקת חומרי גלם שהכמות הזמינה שלהם קטנה מ־1, ושלא נעשה בהם שימוש בשנתיים האחרונות, כדי לשמור על מלאי מעודכן ויעיל.

3️⃣ השאילתה מוחקת תהליכי ייצור שסומנו בטעות עם תאריך סיום בעתיד, מכיוון שבמערכת תקינה תאריך הסיום לא אמור להיות מאוחר מהתאריך הנוכחי.

פעולות ROLLBACK ו־COMMIT
⚙️ עדכון זמני עם ROLLBACK
הכנסנו שורה חדשה לטבלת raw_materials עם מזהה זמני, מבלי לבצע COMMIT. לאחר מכן בוצע ROLLBACK והשורה נעלמה – דבר הממחיש ביטול פעולה שטרם אושרה.

BEGIN;
INSERT INTO raw_materials (materialid_, name_, quantityavailable_)
VALUES (9999, 'טסט ביטול', 100);
-- בדיקת מצב הטבלה (השורה מופיעה)
ROLLBACK;
-- בדיקת מצב הטבלה מחדש (השורה נעלמה)
✅ עדכון ואישור עם COMMIT
בוצע שינוי על חומר גלם קיים, ולאחר מכן אושר באמצעות COMMIT. הבדיקה מראה כי הנתונים נשמרו לאחר אישור סופי.

BEGIN;
UPDATE raw_materials
SET quantityavailable_ = quantityavailable_ + 15
WHERE materialid_ = 1001;
 
תמונה: 

COMMIT;
תמונה: 

🧱 אילוצים (Constraints)
1️⃣ אילוץ NOT NULL בטבלת employee
בוצע על העמודה name כדי לוודא שלא ניתן להוסיף עובד ללא שם.

ALTER TABLE employee
ALTER COLUMN name SET NOT NULL;
 ![אילוץ ראשון](שלב%20ב/images/con1E.JPG)

ניסיון להוסיף עובד ללא שם נכשל עם שגיאה.

2️⃣אילוץ 2 – CHECK על finalproduct_.numbottls
המטרה:  אילוץ CHECK שמבטיח שכמות הבקבוקים numbottls לא תהיה שלילית. זה מגן על נתונים לא הגיוניים בדיווחי ייצור.

ALTER TABLE finalproduct_
ADD CONSTRAINT check_positive_bottles CHECK (numbottls >= 0);

 ![אילוץ ראשון](שלב%20ב/images/con2E.JPG)

ניסיון להכניס תאריך בעתיד נתקבל עם שגיאה.

3️⃣ אילוץ FOREIGN KEY בטבלת productionprocess_ על employeeid
המטרה: לוודא שכל employeeid בתהליך יפנה לעובד קיים בטבלת employee

ALTER TABLE productionprocess_
ADD CONSTRAINT fk_employee FOREIGN KEY (employeeid) REFERENCES employee(employeeid);

 ![אילוץ ראשון](שלב%20ב/images/con3E.JPG)
## 🗂️ מבנה התיקיות:

DBProject/ ├── שלב א/ │ ├── createTables.sql │ ├── dropTables.sql │ ├── insertTables.sql │ ├── selectAll.sql │ ├── backup_22042025.backup │ ├── ERD/ │ ├── DSD/ │ ├── Programing/ │ ├── DataImportFiles/ │ └── mockarooFiles/
